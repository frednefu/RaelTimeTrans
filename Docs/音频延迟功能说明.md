# 音频延迟功能说明

## 功能概述

音频延迟功能允许用户为音频输出设置一个指定的延迟时间，这对于需要同步音频和字幕的场景非常有用。特别是在监听系统声音时，可以通过调整延迟使音频输出与翻译字幕更好地同步。

## 使用方法

1. **启用音频延迟**：
   - 在主界面勾选"音频延迟"复选框
   - 通过滑动条调整延迟时间（范围：0-5000毫秒）

2. **适用场景**：
   - 当监听系统声音时，字幕处理需要一定时间
   - 通过延迟音频输出，使听到的声音与看到的字幕更加同步
   - 适用于观看视频、直播或在线会议等场景

3. **使用建议**：
   - 对于不同的模型，建议使用不同的延迟时间：
     - tiny 模型：约 300-500ms
     - base 模型：约 500-1000ms
     - small 模型：约 1000-1500ms
     - medium/large 模型：约 1500-2500ms
   - 实际延迟时间还应根据系统性能和翻译语言对进行调整

## 技术实现

音频延迟功能的实现原理是将输入的音频数据缓存在一个缓冲区中，并在指定的延迟时间后再播放。主要技术实现包括：

1. **缓冲区管理**：
   - 使用Python的列表结构存储音频数据帧
   - 计算延迟所需的帧数 = 延迟时间(ms) × 采样率 / 块大小
   - 当缓冲区大小达到计算出的延迟帧数时开始播放

2. **数据流处理**：
   - 获取输入音频数据后立即添加到缓冲区
   - 每次只播放缓冲区中最早的音频帧
   - 使用FIFO(先进先出)方式管理缓冲区

3. **资源管理**：
   - 当停止录音或关闭应用时自动清理缓冲区
   - 当切换延迟设置时重新计算并调整缓冲区

## 注意事项

1. 延迟功能仅影响音频输出，不影响字幕翻译的实时性
2. 较大的延迟值可能会导致明显的音频延迟感，建议根据实际需求调整
3. 系统性能较低时，过高的延迟值可能导致内存占用增加
4. 延迟设置会保存在配置文件中，下次启动应用时会自动加载

## 性能影响

延迟功能对系统性能的影响主要体现在内存使用上：

- 16kHz采样率，16位音频，延迟1000ms约占用额外32KB内存
- 在大多数现代系统上，此功能的性能影响可以忽略不计 