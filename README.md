# 实时翻译软件

这是一个使用Whisper的即时翻译软件，支持通过音频（捕获电脑到音频的输入或输出设备），直接实时地判断原语言，并翻译成目标语言，通过字幕显示在屏幕上。可以设置和预览字幕的颜色、位置、大小等样式。

## 功能特点

- 实时捕获系统声音或麦克风输入
- 使用OpenAI的Whisper模型进行语音识别
- 自动检测源语言并翻译到目标语言
- 支持多种目标语言（中文、英语、日语、韩语等）
- 可自定义字幕样式（颜色、大小、位置）
- 预览功能帮助调整字幕效果
- 字幕窗口宽度自适应，尽量避免文本换行
- 实时显示识别语言和延迟信息
- 支持"不翻译"选项，直接显示原文提高响应速度
- 自动保存识别的字幕为SRT格式，便于回看和分享
- 支持业余无线电术语自定义翻译，准确识别专业术语（如CQ、QRZ、73等）

## 系统要求

- Windows 10/11
- Python 3.8+（推荐使用Conda环境）
- 可用的音频输入/输出设备
- 网络连接（用于Google翻译服务）

## 安装步骤

### 方法一：使用Conda环境（推荐）

1. 确保已安装Conda（可以使用[Miniconda](https://docs.conda.io/en/latest/miniconda.html)或Anaconda）
2. 克隆或下载本仓库
3. 使用以下交互式批处理脚本来管理环境和运行程序：

   - **FixDependencies.bat** - 交互式环境创建与管理工具
     - 可以创建或删除conda环境
     - 支持从requirements.txt安装依赖
     - 提供用户交互选项

   - **RunApp.bat** - 启动脚本
     - 检查环境是否存在，不存在时可选择创建
     - 自动激活环境并运行程序
     - 提供错误处理与调试选项

   - **ExportEnv.bat** - 环境导出工具
     - 支持导出为environment.yml或requirements.txt
     - 可以选择仅导出conda环境或pip依赖
     - 导出结果可用于在其他机器上重建环境

> **注意**：所有批处理脚本使用英文界面，以避免在Windows命令行中可能出现的中文乱码问题。

### 方法二：手动安装

1. 克隆或下载本仓库：
   ```
   git clone [仓库URL]
   cd 实时翻译软件
   ```

2. 安装必要的依赖：
   ```
   pip install -r requirements.txt
   ```
   
   注意：如果安装PyAudio时遇到问题，可以尝试：
   - 从[非官方的Python扩展包](https://www.lfd.uci.edu/~gohlke/pythonlibs/#pyaudio)下载对应版本的wheel文件手动安装

3. 首次运行时，程序会自动下载Whisper模型（约1GB），请确保网络连接畅通。

## 使用方法

1. 启动程序：
   - 使用Conda环境（推荐）：
     - 双击 `RunApp.bat`
   - 手动启动：
     ```
     python main.py
     ```

2. 在界面中选择：
   - 音频输入设备（例如麦克风）
   - 或选中"监听系统声音"以捕获电脑的音频输出
   - 选择目标翻译语言
   - 调整字幕样式（大小、颜色、位置）

3. 点击"预览字幕"可以查看当前设置下字幕的显示效果。

4. 点击"开始翻译"开始实时翻译，再次点击停止翻译。

5. 字幕将以SRT格式自动保存在"Subtitles"目录下，文件名为开始录制的时间戳。

## 高级功能

### 检测语言和延迟显示

- 界面实时显示检测到的原语言
- 显示语音识别延迟和翻译延迟，方便评估系统性能

### 字幕自适应宽度

- 字幕窗口会根据文本内容自动调整宽度
- 尽量保证文本在一行显示，避免不必要的换行
- 同时遵循用户设置的最大宽度限制

### "不翻译"选项

- 在目标语言下拉菜单中选择"不翻译"
- 直接显示语音识别的原文，跳过翻译步骤
- 大幅降低字幕显示延迟，适合仅需识别不需翻译的场景

### 字幕文件保存

- 每次开始到结束翻译期间的内容会自动保存为SRT格式
- 保存在"Subtitles"目录，可用于视频后期制作
- 文件名为开始录制的时间戳，便于查找

### 业余无线电术语翻译

- 自动识别常用业余无线电术语（如CQ、QRZ、73等）
- 翻译成对应语言的专业术语解释，而非直接翻译
- 术语库可通过编辑JSON文件扩展，位于`translation/resources/ham_radio_terms.json`
- 详细使用说明可查看`Docs/业余无线电术语翻译功能.md`

## 环境管理

环境管理通过交互式批处理脚本完成：

1. **创建或修复环境**：运行 `FixDependencies.bat`
   - 提供交互式选项创建、删除和重建环境
   - 支持从requirements.txt安装依赖
   - 出错时提供明确的错误信息和解决方案

2. **导出环境**：运行 `ExportEnv.bat`
   - 可选择导出为environment.yml或requirements.txt
   - 支持在其他机器上使用`conda env create -f environment.yml`重建环境

## 常见问题解决

如果遇到以下问题，请尝试相应的解决方案：

1. **批处理脚本显示乱码**：
   - 这是由于Windows命令行的编码问题导致的
   - 所有批处理脚本已改为使用英文界面，避免中文乱码问题
   - 如果仍有问题，可以尝试修改命令行的编码为UTF-8：`chcp 65001`

2. **依赖问题**：
   - 运行 `FixDependencies.bat` 重新安装所有依赖
   - 脚本会提供交互选项重建环境或修复依赖

3. **PyAudio安装失败**：
   - 脚本会尝试从conda-forge安装PyAudio
   - 如失败，请从[非官方的Python扩展包](https://www.lfd.uci.edu/~gohlke/pythonlibs/#pyaudio)下载对应wheel文件手动安装

4. **程序崩溃或异常退出**：
   - 运行 `RunApp.bat` 启动程序，它会提供错误信息和调试选项
   - 如果是依赖问题，脚本会提示运行 `FixDependencies.bat`

5. **翻译功能无法使用**：
   - 确保您的网络连接正常，翻译功能依赖于Google翻译服务
   - 如果仅需语音识别功能，可以选择"不翻译"选项

## 注意事项

- Whisper模型需要一定的计算资源，建议使用配置较好的电脑。
- 翻译功能需要网络连接，使用的是Google翻译服务（无需API密钥）。
- 翻译服务有请求频率限制，过于频繁的请求可能导致暂时性封禁。
- 翻译结果的准确性取决于语音识别和翻译服务的质量。
- 目前支持的目标语言有：中文、英语、日语、韩语、法语、德语、俄语、西班牙语。
- 首次运行时，程序会自动下载Whisper模型（约1GB），请确保网络连接畅通。

## 许可证

本项目使用 MIT 许可证 - 查看 LICENSE 文件了解详情。

## 致谢

- OpenAI Whisper - 用于语音识别
- PySide6 - 用于图形界面
- googletrans - 用于文本翻译
- PyAudio 和 sounddevice - 用于音频处理 